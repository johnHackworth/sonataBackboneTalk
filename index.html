<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>SONATA USA Corp. tech talks - Backbone</title>

    <meta name="author" content="Johnhackworth">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewpogt" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Backbone.js</h1>
          <h3>A little intro to MVC on client</h3>
          <p>
            <small>Created by <a href="http://github.com/johnhackwogth">Javi A.</a> / <a href="http://twitter.com/johnhackwogth">@johnhackworth</a></small>
          </p>
        </section>

        <section>
          <h2>Un poco de historia</h2>
        </section>
        <section>
          <h3>De dónde venimos</h3>
          <h4> Pre-2004 </h4>
          <ul>
            <li>Html plano</li>
            <li>Plantillas renderizadas en servidor (java, asp, algo de php..)</li>
            <li>AJAX? WTF?</li>
            <li>El server manda en TODO</li>
          </ul>
        </section>
        <section>
          <h3>Por ejemplo: </h3>
          <img src="http://unix.rulez.org/~calver/pictures/bush_hotmail.jpg" />
        </section>
        <section>
          <h3> YUI, Prototype & Dojo Toolkit </h3>
          <h4> 2004 - 2006 </h4>
          <ul>
            <li>Plantillas renderizadas en servidor (java, php)</li>
            <li>Interacción "rica" en cliente, vía javascript</li>
            <li>Primeros intentos de 'domar' la prog. cliente (dojo)</li>
            <li>Complicado de la hostia, incompatibilidades entre browsers</li>
          </ul>
        </section>
        <section>
          <h3>Por ejemplo: </h3>
          <img src="http://www.idealista.com/news/archivos/imagenes/portales/idealista-italia-home.jpg" />
        </section>
        <section data-background="#FCFCFC">
          <h3 style="color: #333333;"> 2006 </h3>
          <img src="http://www.startupsopensourced.com/wp-content/uploads/2011/06/john_resig.jpg" />
        </section>
        <section>
          <h3> jQuery </h3>
          <h4> 2006 - 2010 </h4>
          <ul>
            <li>Estandarización entre browsers</li>
            <li>Eliminación de diferencias entre browsers</li>
            <li>Consistencia entre browsers</li>
            <li>Un sólo desarrollo para diferentes browsers</li>
            <li>La programación en cliente como programación, no como puzzle</li>
            <li>Sistema de plugins FÁCIL + componentes interfaz estandar</li>
          </ul>
        </section>
        <section>
          <h3> 2011 </h3>
          <img src="http://2011.full-frontal.org/images/speakers/jeremy.jpg" />
        </section>
        <section>
          <h3> Backbone, Spine, Ember, Angular, Coffeescript, Batman, blahblahblah </h3>
          <h4> 2011+ </h4>
          <ul>
            <li>Aplicación de paradigmas de servidor al cliente</li>
            <li>MVC, MVVM, etc </li>
            <li>Lógica de presentación en cliente</li>
            <li>Thick Client (cliente pesado)</li>
            <li>AMD</li>
          </ul>
        </section>

        <section>
          <h2>MVC (Modelo Vista Controlador)</h2>
        </section>

        <section>
          <h3>Modelo</h3>
          <p>
            Capa que almacena la lógica de negocio. En nuestro caso, una serie de clases (prototipos) de javascript
          </p>
        </section>

        <section>
          <h3>Vista</h3>
          <p>
            Capa que presenta la información e interactua con el usuario. En este caso en concreto, HTML renderizado en navegador vía plantillas
          </p>
        </section>

        <section>
          <h3>Controlador</h3>
          <p>
            Capa que orquesta las interacciones entre la vista y el modelo. Pinta la vista en función de lo que pase en el modelo y notifica al modelo lo que pasa en la vista.
          </p>
        </section>

        <section id="themes">
          <h2>Backbone</h2>
        </section>
        <section data-transition="linear" data-background="#8c4738" data-background-transition="slide">
          <h2>Qué es backbone?</h2>
          <p>
            Backbone es un framework MVC muy muy ligero<br/> (1500 lineas de código en total).
          </p><p>Proporciona:
          <ul>
          <li> Una abstracción de la capa de persistencia de datos (una API rest)
          </li><li> Un sistema de gestión de rutas
          </li><li> Un sistema de herencia de clases (para modelos y controladores)
          </li><li>Una estructura estandar (models (modelos), views (controllers), vistas (el sistema de plantillas que quiera el usuario))
          </li></ul>
          </p>
        </section>
        <section data-transition="linear" data-background="#8c4738" data-background-transition="slide">
          <h2>Qué NO es backbone?</h2>
          <p>
            Para todo lo demás, Backbone es no-opionated. Es agnóstico a que sistema de plantillas se utilize, a que se use para hacer el data binding, testing, etc.
          </p>
          <p>
            Las únicas dependencias 'duras' de backbone son jquery/zepto y underscore (y json2 si se quiere compatibilidad con Satán (ie < 9))
          </p>
        </section>

        <section>
          <h2>Ventajas y desventajas del un-opinionantismo</h2>
          <ul>
            <li>+ Da mucha flexibilidad al usuario y no te impone como hacer las cosas</li>
            <li>- Obliga a tomar decisiones desde el principio, por lo que los primeros pasos pueden ser más duros </li>
            <li>+ Mucho más adaptable al proyecto</li>
            <li>- Necesidad de mucho boilerplate</li>
          </ul>
        </section>

        <section>
          <h3>MVC en backbone</h3>
          <div style="
            width:100%;
            padding:10px;
          ">
            <div class="view" style="
              padding:5px;
              text-align:center;
            ">
            (L)User
            </div>
            <div class="connections" style="
              padding: 10px 0;
              width:100%;
            ">
              <span style="width:50px;"><span style="font-size:40px">↑</span> Output</span><span style="width:40px; margin-left:100px">Input<span style="font-size:40px">↓</span></span>
            </div>
            <div class="view" style="
              background-color: #FF9966;
              color: #333333;
              padding:10px;
              width:600px;
              margin: auto;
            ">
            View (Templates)
            </div>
            <div class="connections" style="
              padding: 10px 0;
              width:100%;
            ">
              <span style="width:50px;"><span style="font-size:40px">↑</span> .html()</span><span style="width:40px; margin-left:100px">DOM events<span style="font-size:40px">↓</span></span>
            </div>

            <div class="view" style="
              background-color: #99FF66;
              margin-left:20px
              color: #333333;
              padding:10px;
              width:600px;
              margin: auto;
            ">
            Controllers (Backbone.View)
            </div>
            <div class="connections" style="
              padding: 10px 0;
              width:100%;
            ">
              <span style="width:50px;"><span style="font-size:40px">↑</span> model events</span><span style="width:40px; margin-left:100px">model methods<span style="font-size:40px">↓</span></span>
            </div>
            <div class="view" style="
              background-color: #9966FF;
              margin-left:20px
              color: #333333;
              width:600px;
              padding:10px;
              margin: auto;
            ">
            Models (Backbone.Model)
            </div>
            <div class="connections" style="
              padding: 10px 0;
              width:100%;
            ">
              <span style="width:50px;"><span style="font-size:40px">↑</span> AJAX  <span style="font-size:40px">↓</span></span>
            </div>

            <div class="view" style="
              padding:5px;
              text-align:center;
            ">
            Data persistence ⛁ (API REST)
            </div>

          </div>

        </section>

        <section>
          <h3> Modelos </h3>
          <p> Modelan un recurso. Normalmente se "suscriben" (vía .url) a un punto de entrada de una API rest y consumen y persisten los datos a través de ese entry point.</p><br/><br/>
          <h4>Propiedades importantes</h4>
          <ul>
            <li>.url / .url() </li>
            <li>.get() / .set() (siempre!)</li>
            <li>.toJSON() </li>
            <li>.defaults (cuidado!)</li>
            <li>.fetch() -> GET</li>
            <li>.save() -> POST o PUT </li>
            <li>.destroy() -> DELETE </li>
            <li>.validate() </li>
          </ul>

        </section>

        <section>
          <h3> Un modelo de backbone </h3>
          <pre>
            <code class="javascript">
              var UserModel = Backbone.Model.extend({
                defaults: {
                  name: '',
                  age: 0
                },
                initialize: function(params) {
                  this.friends = [] // importante hacer esto así!
                },
                url: 'http://example.com/user/'
              })
            </code>
          </pre>
        </section>

        <section>
          <h3> Colecciones </h3>
          <p> Arrays de modelos con cierta funcionalidad propia </p>
          <br/>
          <ul>
            <li>.url -> Recurso que devuelve un array de datos</li>
            <li>.model -> Model de backbone al que castea los datos</li>
            <li>.fetch / .toJSON / etc </li>
            <li>No ofrece paginación (maaaaaal)</li>
          </ul>
        </section>

        <section>
          <h3>Controller (Backbone.View)</h3>
          <p>Enlaza los datos (modelo) con lo que ve el usuario (templates). Escucha eventos en ambos sitios y lanza las acciones adecuadas cuando se producen </p>
          <br/>
          <h4>Propiedades importantes</h4>
          <ul>
            <li>.el -> nodo jQuery del DOM dónde se pintará la vista asociada</li>
            <li>.render() -> Método que lanza el pintado de la vista en el DOM</li>
            <li>.events -> Diccionario con las acciones que se lanzan cuando se producen eventos en el DOM </li>
            <li>.model -> Instancia de un model asociada a la vista</li>
          <ul>
        </section>
        <section>
          <h3> Un ejemplo de controller </h3>
          <pre>
            <code class="javascript">
              var userProfileController = Backbone.View.extend({
                events: {
                  "click .save": "saveUser",
                  "change .name": "updateName"
                },
                initialize: function(options) {
                  this.template = options.template;
                  this.listenTo(this.model, 'change', this.render.bind(this));
                  // importante usar .listenTo y no .on
                  this.model.fetch();
                },
                saveUser: function() {
                  this.model.save();
                },
                updateName: function() {
                  var userName = this.$('.name').val();
                  this.model.set('name', userName);
                },
                render: function() {
                  var userData = this.model.toJSON();
                  var view = _.template(this.template, userData);
                  this.$el.html(view)
                }
              })
            </code>
          </pre>
        </section>


        <section>
          <h3>Vista</h3>
          <p>Cualquier sistema de plantillas que utilicemos para renderizar la salida al usuario. Por ejemplo, underscore templates o handlebars.</p>
        </section>

        <section>
          <h3>Un ejemplo de plantilla</h3>
          <pre>
            <code class="html">
              &lt;div class="userProfile"&gt;
                &lt;%= name %&gt;
              &lt;/div&gt;
              <div class="userAddresses">
                <% addresses.each(function(e,i) {
                  print('<div class="address">' + e + '</div>')
                }) %>
              </div>
            </code>
          </pre>
        </section>

        <section>
          <h3>Routers</h3>
          <p>
            Escuchan los cambios en el hash de la url y ejecutan acciones en función de ellos. También pueden usarse con urls completas, usando Push State.
          </p>
          <p>
             Backbone.history.start() pone a backbone a escuchar los cambios en la url
          </p>
          <br/>
        </section>


        <section>
          <h3> Un ejemplo de Router </h3>
          <pre>
            <code class="javascript">
              var routes = Backbone.Router.extend({
                routes: {
                  "!/userProfile/:id": "showUserProfile"
                  // http://example.com/#!/userProfile
                },
                showUserProfile: function(id) {
                  var userModel = new userModel({id: id});
                  var userController = new userProfileController({
                    el: $('.profile'),
                    model: userModel
                  })
                }
              })

              Backbone.history.start()
            </code>
          </pre>
        </section>
        <section>
          <h3>Boilerplate</h3>
          <h4>(AKA: Cosas que hay que escribir en cada proyecto)</h4>
          <ul>
            <li>Data Binding</li>
            <li>Carga de Templates & estáticos</li>
            <li>Parent inheritance</li>
            <li>Gestión de memoria en binds a modelos</li>
          </ul>
          <br/><br/>
          <p>En principio, Marionette dará algunas de estas cosas resueltas, el resto están ya resueltas en sonata Retail</p>
        </section>
        <section>
          <h3>process.end()</h1>
          <img src="http://i.qkme.me/3orsgz.jpg"></img>
          <h3>Preguntas?</h3>
        </section>
      </div>


    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: 'night', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
